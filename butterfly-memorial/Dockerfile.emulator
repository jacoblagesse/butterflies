FROM node:20-alpine

# firebase-tools + Java runtime for emulators
RUN apk add --no-cache openjdk17-jre-headless \
    && npm install -g firebase-tools \
    && npm cache clean --force

WORKDIR /app

COPY firebase.json .firebaserc ./
COPY functions/package*.json functions/
RUN cd functions && npm install --omit=dev

COPY functions/ functions/

EXPOSE 4000 5001

CMD ["firebase", "emulators:start", "--only", "functions", "--project", "butterfly-memorial"]
